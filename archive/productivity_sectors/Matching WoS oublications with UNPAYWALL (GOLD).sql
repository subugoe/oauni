SELECT COUNT(DISTINCT GESISNABEDIYARAND.GERMAN_UNI_KB_DETAILS.FK_ITEMS),
GESISNABEDIYARAND.GERMAN_UNI_KB_DETAILS.FK_KB_SECTORS,
GESISNABEDIYARAND.GERMAN_UNI_KB_DETAILS.PK_KB_INST

FROM GESISNABEDIYARAND.GERMAN_UNI_KB_DETAILS INNER JOIN GESISFMOMENI.OASE_UNPAYWALL_ALL
ON LOWER(GESISNABEDIYARAND.GERMAN_UNI_KB_DETAILS.DOI) = LOWER(GESISFMOMENI.OASE_UNPAYWALL_ALL.DOI)

AND UPPER(GESISNABEDIYARAND.GERMAN_UNI_KB_DETAILS.ARTICLE_TITLE) = UPPER(GESISFMOMENI.OASE_UNPAYWALL_ALL.TITLE)
WHERE GESISNABEDIYARAND.GERMAN_UNI_KB_DETAILS.DOCTYPE IN ('Article','Review')
AND GESISNABEDIYARAND.GERMAN_UNI_KB_DETAILS.PUBYEAR BETWEEN 2008 AND 2018
AND OASE_UNPAYWALL_ALL.IS_OA = 't'AND OASE_UNPAYWALL_ALL.JOURNAL_IS_OA = 't'

GROUP BY GESISNABEDIYARAND.GERMAN_UNI_KB_DETAILS.FK_KB_SECTORS,
        GESISNABEDIYARAND.GERMAN_UNI_KB_DETAILS.PK_KB_INST
        
        
ORDER BY GESISNABEDIYARAND.GERMAN_UNI_KB_DETAILS.FK_KB_SECTORS,
         GESISNABEDIYARAND.GERMAN_UNI_KB_DETAILS.PK_KB_INST;
